---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Hero from '../components/Hero.astro';
import MobileHero from '../components/MobileHero.astro';
import BenefitCard from '../components/BenefitCard.astro';
import ProcessStep from '../components/ProcessStep.astro';
import TestimonialCard from '../components/TestimonialCard.astro';
import PortfolioCard from '../components/PortfolioCard.astro';
import FAQItem from '../components/FAQItem.astro';
import TeamMember from '../components/TeamMember.astro';
import { getCollection } from 'astro:content';

// Fetch content from collections
const benefits = (await getCollection('benefits')).sort((a, b) => a.data.order - b.data.order);
const process = (await getCollection('process')).sort((a, b) => a.data.step - b.data.step);
const testimonials = await getCollection('testimonials');
const portfolio = (await getCollection('portfolio')).sort((a, b) => (a.data.order || 99) - (b.data.order || 99));
const team = await getCollection('team');
const faq = (await getCollection('faq')).sort((a, b) => a.data.order - b.data.order);
---

<BaseLayout
  title="Idle Fusion - Modern App & Web Development Consulting"
  description="Expert app and web development consulting for modern businesses. We create digital solutions that drive results."
>
  <Header currentPage="home" />

  <main>
    <!-- Mobile Hero (visible on mobile/tablet only) -->
    <MobileHero
      tagline="Trusted by businesses worldwide"
      title="Idle Fusion"
      subtitle="Custom apps and websites that engage users, drive growth, and give you a competitive edge."
      primaryCTA={{ text: "Get in Touch", href: "/contact" }}
    />

    <!-- Desktop Hero (visible on desktop only) -->
    <div class="hidden lg:block">
      <Hero
        tagline="Trusted by businesses worldwide"
        title="Transform Your Business with Expert App & Web Development"
        subtitle="Stop struggling with outdated technology or lackluster digital solutions. We deliver custom apps and websites that engage users, drive growth, and give you a competitive edge."
        primaryCTA={{ text: "Start Your Project", href: "/contact" }}
        secondaryCTA={{ text: "See Our Work", href: "#our-work" }}
      />
    </div>

    <!-- Benefits Section -->
    <section class="section-padding" id="services">
      <div class="section-container">
        <div class="section-header">
          <span class="section-number">01</span>
          <div class="section-divider-line"></div>
        </div>

        <div class="section-intro">
          <h2 class="section-title">
            Why Work With Us
          </h2>
          <p class="section-subtitle">
            Focus on what matters â€” growing your business while we handle the technology
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
          {benefits.map(benefit => (
            <BenefitCard
              title={benefit.data.title}
              description={benefit.data.description}
              icon={benefit.data.icon}
            />
          ))}
        </div>
      </div>
    </section>

    <!-- How It Works Section -->
    <section class="section-padding section-alt" id="how-it-works">
      <div class="section-container">
        <div class="section-header">
          <span class="section-number">02</span>
          <div class="section-divider-line"></div>
        </div>

        <div class="section-intro">
          <h2 class="section-title">
            How It Works
          </h2>
          <p class="section-subtitle">
            A simple, transparent process from concept to launch
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12">
          {process.map(step => (
            <ProcessStep
              title={step.data.title}
              description={step.data.description}
              step={step.data.step}
            />
          ))}
        </div>
      </div>
    </section>

    <!-- Testimonials Section -->
    <section class="section-padding" id="testimonials">
      <div class="section-container">
        <div class="section-header">
          <span class="section-number">03</span>
          <div class="section-divider-line"></div>
        </div>

        <div class="section-intro">
          <h2 class="section-title">
            What Clients Say
          </h2>
          <p class="section-subtitle">
            Real feedback from people we've worked with
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
          {testimonials.map(testimonial => (
            <TestimonialCard
              name={testimonial.data.name}
              company={testimonial.data.company}
              quote={testimonial.data.quote}
              image={testimonial.data.image}
              rating={testimonial.data.rating}
            />
          ))}
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <section class="section-padding section-alt" id="faq">
      <div class="section-container">
        <div class="section-header">
          <span class="section-number">04</span>
          <div class="section-divider-line"></div>
        </div>

        <div class="section-intro">
          <h2 class="section-title">
            Common Questions
          </h2>
          <p class="section-subtitle">
            Everything you need to know before we start
          </p>
        </div>

        <div class="max-w-3xl">
          {faq.map((item, index) => (
            <FAQItem
              question={item.data.question}
              answer={item.data.answer}
              index={index + 1}
              isFirst={index === 0}
            />
          ))}
        </div>
      </div>
    </section>

    <!-- Our Work Section -->
    <section class="section-padding" id="our-work">
      <div class="section-container">
        <div class="section-header">
          <span class="section-number">05</span>
          <div class="section-divider-line"></div>
        </div>

        <div class="section-intro">
          <h2 class="section-title">
            Selected Work
          </h2>
          <p class="section-subtitle">
            Projects we're proud of
          </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
          {portfolio.map(project => (
            <PortfolioCard
              title={project.data.title}
              description={project.data.description}
              image={project.data.image}
              url={project.data.url}
            />
          ))}
        </div>
      </div>
    </section>

    <!-- Leadership Section -->
    <section class="section-padding section-alt" id="leadership">
      <div class="section-container">
        <div class="section-header">
          <span class="section-number">06</span>
          <div class="section-divider-line"></div>
        </div>

        <div class="section-intro">
          <h2 class="section-title">
            About
          </h2>
          <p class="section-subtitle">
            The person behind the work
          </p>
        </div>

        <div class="max-w-3xl">
          {team.map(member => (
            <TeamMember
              name={member.data.name}
              role={member.data.role}
              image={member.data.image}
              bio={member.data.bio}
              socialLinks={member.data.socialLinks}
              additionalContent="Matthew is dedicated to delivering world-class solutions that are beautiful, simple, and effective. He believes that technology should enable the future while remaining accessible and user-friendly."
            />
          ))}
        </div>
      </div>
    </section>

    <!-- Final CTA Section -->
    <section class="cta-section" id="contact">
      <div class="section-container py-20 md:py-28">
        <div class="cta-content">
          <h2 class="cta-title">
            Ready to start?
          </h2>
          <p class="cta-subtitle">
            Let's discuss your project and see how we can bring your vision to life.
          </p>
          <div class="cta-actions">
            <a href="/contact" class="btn btn-light text-base px-8 py-4">
              Get in touch
              <svg class="cta-arrow" width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M4 10H16M16 10L11 5M16 10L11 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer variant="full" />
</BaseLayout>

<style>
  /* Section container */
  .section-container {
    max-width: 72rem;
    margin: 0 auto;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }

  @media (min-width: 640px) {
    .section-container {
      padding-left: 2rem;
      padding-right: 2rem;
    }
  }

  @media (min-width: 1024px) {
    .section-container {
      padding-left: 3rem;
      padding-right: 3rem;
    }
  }

  /* Section header with number */
  .section-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .section-number {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.05em;
    color: var(--text-muted);
  }

  .section-divider-line {
    flex: 1;
    height: 1px;
    background: var(--border-color);
  }

  /* Section intro */
  .section-intro {
    margin-bottom: 3rem;
  }

  .section-title {
    font-family: 'Instrument Serif', Georgia, serif;
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 400;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    letter-spacing: -0.02em;
    line-height: 1.1;
  }

  .section-subtitle {
    font-family: 'Satoshi', sans-serif;
    font-size: 1rem;
    color: var(--text-muted);
    max-width: 32rem;
    line-height: 1.6;
  }

  /* Alternating section background */
  .section-alt {
    background: var(--bg-secondary);
  }

  /* CTA Section */
  .cta-section {
    background: var(--ink);
    position: relative;
    overflow: hidden;
  }

  .cta-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
      linear-gradient(to right, rgba(250, 250, 249, 0.03) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(250, 250, 249, 0.03) 1px, transparent 1px);
    background-size: 80px 80px;
    pointer-events: none;
  }

  .dark .cta-section {
    background: #0a0a0a;
    border-top: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
  }

  .cta-content {
    position: relative;
    z-index: 1;
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }

  .cta-title {
    font-family: 'Instrument Serif', Georgia, serif;
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 400;
    color: var(--paper);
    margin-bottom: 1rem;
    letter-spacing: -0.02em;
    line-height: 1.1;
  }

  .cta-subtitle {
    font-family: 'Satoshi', sans-serif;
    font-size: 1.125rem;
    color: var(--paper);
    opacity: 0.7;
    margin-bottom: 2.5rem;
    line-height: 1.6;
  }

  .cta-actions {
    display: flex;
    justify-content: center;
  }

  .cta-arrow {
    margin-left: 0.5rem;
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .btn:hover .cta-arrow {
    transform: translateX(4px);
  }
</style>

<script>
  // Scroll-triggered reveal animations
  const observerOptions = {
    root: null,
    rootMargin: '0px',
    threshold: 0.1
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, observerOptions);

  // Observe elements with reveal class
  document.querySelectorAll('.reveal, .stagger-children').forEach(el => {
    observer.observe(el);
  });
</script>
