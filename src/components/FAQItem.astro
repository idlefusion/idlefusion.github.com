---
interface Props {
  question: string;
  answer: string;
  index: number;
  isFirst?: boolean;
}

const { question, answer, index, isFirst = false } = Astro.props;
const id = `faq-${index}`;
---

<div class="faq-item" data-accordion>
  <button
    class="faq-button"
    type="button"
    aria-expanded={isFirst ? 'true' : 'false'}
    aria-controls={id}
    data-accordion-trigger
  >
    <span class="question">{question}</span>
    <svg class={`icon ${isFirst ? 'rotate' : ''}`} data-accordion-icon width="20" height="20" viewBox="0 0 20 20" fill="none">
      <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>
  <div
    id={id}
    class={`faq-content ${isFirst ? '' : 'hidden'}`}
    data-accordion-content
  >
    <p>{answer}</p>
  </div>
</div>

<script>
  document.querySelectorAll('[data-accordion]').forEach(accordion => {
    const trigger = accordion.querySelector('[data-accordion-trigger]');
    const content = accordion.querySelector('[data-accordion-content]');
    const icon = accordion.querySelector('[data-accordion-icon]');

    trigger?.addEventListener('click', () => {
      const isExpanded = trigger.getAttribute('aria-expanded') === 'true';

      // Close all other accordions
      document.querySelectorAll('[data-accordion]').forEach(other => {
        if (other !== accordion) {
          const otherTrigger = other.querySelector('[data-accordion-trigger]');
          const otherContent = other.querySelector('[data-accordion-content]');
          const otherIcon = other.querySelector('[data-accordion-icon]');
          otherTrigger?.setAttribute('aria-expanded', 'false');
          otherContent?.classList.add('hidden');
          otherIcon?.classList.remove('rotate');
        }
      });

      // Toggle current accordion
      trigger.setAttribute('aria-expanded', (!isExpanded).toString());
      content?.classList.toggle('hidden');
      icon?.classList.toggle('rotate');
    });
  });
</script>

<style>
  .faq-item {
    border-bottom: 1px solid var(--border-color);
  }

  .faq-button {
    width: 100%;
    padding: 1.5rem 0;
    text-align: left;
    background: transparent;
    border: none;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1.5rem;
    transition: color 0.2s;
  }

  .question {
    font-family: 'Satoshi', sans-serif;
    font-size: 1rem;
    font-weight: 500;
    color: var(--text-primary);
    line-height: 1.4;
  }

  .faq-button:hover .question {
    color: var(--accent);
  }

  .icon {
    color: var(--text-muted);
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1), color 0.2s;
    flex-shrink: 0;
  }

  .icon.rotate {
    transform: rotate(180deg);
    color: var(--accent);
  }

  .faq-button:hover .icon {
    color: var(--accent);
  }

  .faq-content {
    padding-bottom: 1.5rem;
  }

  .faq-content p {
    font-family: 'Satoshi', sans-serif;
    font-size: 0.9375rem;
    color: var(--text-muted);
    line-height: 1.7;
    margin: 0;
    max-width: 90%;
  }

  .hidden {
    display: none;
  }
</style>
